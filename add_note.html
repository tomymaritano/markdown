<!DOCTYPE html>
<html>
<head>
    <title>Add Hybrid Storage Note</title>
</head>
<body>
    <h1>Adding Hybrid Storage Note...</h1>
    <div id="status">Processing...</div>

    <script>
        const noteContent = `# Sistema de Almacenamiento H√≠brido - Roadmap de Implementaci√≥n

## üéØ Resumen Ejecutivo

Implementar un sistema de almacenamiento h√≠brido similar a **Inkdrop** que permita a los usuarios elegir entre:
- **Modo Local**: Solo localStorage (actual)
- **Modo Cloud**: Sincronizaci√≥n con backend + offline support

## üìä Estado Actual

### ‚úÖ Backend - COMPLETAMENTE LISTO
- **Servidor**: Node.js + TypeScript + Express.js
- **Base de datos**: Prisma ORM + SQLite
- **APIs**: Endpoints completos (\`/api/notes\`, \`/api/tags\`, \`/api/notebooks\`)
- **Docker**: Configuraci√≥n para desarrollo y producci√≥n
- **Ubicaci√≥n**: \`/server/\`

### ‚ö†Ô∏è Frontend - SOLO LOCALSTORAGE
- **Actual**: \`StorageService\` usa localStorage exclusivamente
- **Store**: Zustand (\`simpleStore.ts\`) sin integraci√≥n con API
- **Falta**: Capa de servicios API y configuraci√≥n h√≠brida

## üèóÔ∏è Arquitectura Propuesta

### 1. Patr√≥n Adapter para Storage
\`\`\`typescript
interface StorageAdapter {
  getNotes(): Promise<Note[]>
  saveNote(note: Note): Promise<void>
  deleteNote(id: string): Promise<void>
  // ... otros m√©todos
}

class LocalStorageAdapter implements StorageAdapter
class CloudStorageAdapter implements StorageAdapter
\`\`\`

### 2. Storage Manager
\`\`\`typescript
class StorageManager {
  constructor(private adapter: StorageAdapter)
  
  switchMode(mode: 'local' | 'cloud'): Promise<void>
  migrateData(from: StorageAdapter, to: StorageAdapter): Promise<void>
}
\`\`\`

### 3. Settings Integration
\`\`\`typescript
interface Settings {
  storageMode: 'local' | 'cloud'
  syncPreferences: {
    autoSync: boolean
    syncInterval: number
    conflictResolution: 'local' | 'remote' | 'ask'
  }
}
\`\`\`

## üìã Fases de Implementaci√≥n

### üîß Fase 1: Infraestructura Base
- [ ] Crear \`StorageAdapter\` interface
- [ ] Refactorizar \`StorageService\` ‚Üí \`LocalStorageAdapter\`
- [ ] Crear \`StorageManager\` orquestador
- [ ] Agregar \`storageMode\` a settings

### üåê Fase 2: Cloud Storage
- [ ] Implementar \`CloudStorageAdapter\`
- [ ] Crear \`src/services/apiService.ts\`
- [ ] Agregar autenticaci√≥n/JWT
- [ ] Manejo de errores de red

### üîÑ Fase 3: Sincronizaci√≥n
- [ ] Implementar sync bidireccional
- [ ] Resoluci√≥n de conflictos
- [ ] Queue para operaciones offline
- [ ] Sync incremental con timestamps

### ‚öôÔ∏è Fase 4: UI/UX
- [ ] Settings panel para storage mode
- [ ] Indicador de estado de sync
- [ ] Migration wizard
- [ ] Backup/restore functionality

### üß™ Fase 5: Testing & Polish
- [ ] Tests para adapters
- [ ] Manejo de edge cases
- [ ] Performance optimization
- [ ] Documentaci√≥n

## üíª Archivos a Crear

\`\`\`
src/lib/storage/
‚îú‚îÄ‚îÄ StorageAdapter.ts           # Interface definition
‚îú‚îÄ‚îÄ LocalStorageAdapter.ts      # Current system wrapper
‚îú‚îÄ‚îÄ CloudStorageAdapter.ts      # API-based storage
‚îú‚îÄ‚îÄ StorageManager.ts           # Coordination layer
‚îî‚îÄ‚îÄ index.ts                    # Exports

src/services/
‚îú‚îÄ‚îÄ apiService.ts              # HTTP client wrapper
‚îú‚îÄ‚îÄ notesService.ts            # Notes API calls
‚îú‚îÄ‚îÄ tagsService.ts             # Tags API calls
‚îî‚îÄ‚îÄ notebooksService.ts        # Notebooks API calls

src/lib/sync/
‚îú‚îÄ‚îÄ SyncEngine.ts              # Synchronization logic
‚îú‚îÄ‚îÄ ConflictResolver.ts        # Conflict resolution
‚îî‚îÄ‚îÄ OfflineQueue.ts            # Pending operations

src/components/settings/
‚îî‚îÄ‚îÄ StorageSettings.tsx        # Storage mode UI
\`\`\`

## üîß Archivos a Modificar

\`\`\`
src/lib/storage.ts             # Refactor to adapter pattern
src/stores/simpleStore.ts      # Use StorageManager
src/hooks/useSettings.ts       # Add storage settings
src/components/settings/       # Add storage section
\`\`\`

## üöÄ Comandos de Desarrollo

\`\`\`bash
# Modo h√≠brido (recomendado para desarrollo)
npm run dev:fast                # Backend en Docker + Frontend local

# Backend standalone
npm run backend:start           # Solo backend en Docker

# Full Docker
docker-compose up              # Todo en containers
\`\`\`

## üí° Consideraciones T√©cnicas

### Ventajas del Enfoque H√≠brido
- **Flexibilidad**: Usuario elige su preferencia
- **Migraci√≥n gradual**: Transici√≥n suave desde localStorage
- **Offline-first**: Funciona sin conexi√≥n
- **Compatibilidad**: Mantiene datos existentes

### Desaf√≠os a Resolver
- **Conflict Resolution**: ¬øQu√© hacer con cambios concurrentes?
- **Performance**: Optimizar sync para grandes cantidades de notas
- **Security**: Autenticaci√≥n y encriptaci√≥n de datos
- **UX**: Feedback claro durante sync/migration

## üìö Referencias

- **Inkdrop**: Modelo de referencia para storage h√≠brido
- **Obsidian**: Sync opcional con local-first approach
- **Notion**: Cloud-first con offline capabilities

## ‚è±Ô∏è Timeline Estimado

- **Fase 1-2**: 1-2 d√≠as (infraestructura + API)
- **Fase 3**: 2-3 d√≠as (sincronizaci√≥n)
- **Fase 4**: 1 d√≠a (UI/settings)
- **Fase 5**: 1 d√≠a (testing/polish)

**Total**: ~1 semana de desarrollo activo

---

*Nota creada autom√°ticamente - Sistema de documentaci√≥n t√©cnica*`;

        // Crear la nueva nota
        const newNote = {
            id: 'hybrid-storage-roadmap-' + Date.now(),
            title: 'Sistema de Almacenamiento H√≠brido - Roadmap',
            content: noteContent,
            notebook: 'development',
            tags: ['storage', 'backend', 'sync', 'roadmap', 'architecture'],
            status: 'in-progress',
            isPinned: true,
            date: new Date().toISOString(),
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            preview: 'Implementar un sistema de almacenamiento h√≠brido similar a Inkdrop que permita a los usuarios elegir entre modo local y cloud sync...'
        };

        try {
            // Obtener notas existentes
            const existingNotes = JSON.parse(localStorage.getItem('nototo_notes') || '[]');
            
            // Agregar la nueva nota
            existingNotes.push(newNote);
            
            // Guardar de vuelta
            localStorage.setItem('nototo_notes', JSON.stringify(existingNotes));
            
            // Crear el notebook 'development' si no existe
            const existingNotebooks = JSON.parse(localStorage.getItem('nototo_notebooks') || '[]');
            const hasDevNotebook = existingNotebooks.some(nb => nb.name === 'development');
            
            if (!hasDevNotebook) {
                existingNotebooks.push({
                    id: 'development-' + Date.now(),
                    name: 'development',
                    color: '#3b82f6',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                localStorage.setItem('nototo_notebooks', JSON.stringify(existingNotebooks));
            }
            
            document.getElementById('status').innerHTML = `
                <h2 style="color: green;">‚úÖ ¬°Nota creada exitosamente!</h2>
                <p><strong>ID:</strong> ${newNote.id}</p>
                <p><strong>T√≠tulo:</strong> ${newNote.title}</p>
                <p><strong>Notebook:</strong> ${newNote.notebook}</p>
                <p><strong>Tags:</strong> ${newNote.tags.join(', ')}</p>
                <p><strong>Total de notas:</strong> ${existingNotes.length}</p>
                <br>
                <p>üöÄ <strong>Ahora puedes ir a tu aplicaci√≥n nototo en <a href="http://localhost:5174" target="_blank">http://localhost:5174</a> para ver la nota.</strong></p>
            `;
            
        } catch (error) {
            document.getElementById('status').innerHTML = `
                <h2 style="color: red;">‚ùå Error al crear la nota</h2>
                <p>${error.message}</p>
            `;
        }
    </script>
</body>
</html>